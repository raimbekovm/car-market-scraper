#!/bin/bash

echo "================================================================================"
echo "СТАТУС ПАРСЕРА DROM.RU"
echo "================================================================================"
echo ""

# Проверяем запущен ли процесс
if ps aux | grep -v grep | grep "full_parser.py" > /dev/null; then
    echo "✅ Парсер РАБОТАЕТ"
    echo ""
    ps aux | grep -v grep | grep "full_parser.py" | awk '{print "   PID: "$2"\n   CPU: "$3"%\n   Memory: "$4"%\n   Время работы: "$10}'
else
    echo "⚠️  Парсер НЕ РАБОТАЕТ"
fi

echo ""
echo "================================================================================"
echo "ТЕКУЩИЙ ПРОГРЕСС"
echo "================================================================================"
echo ""

# Читаем файл прогресса
if [ -f "drom_full_scraper_progress.json" ]; then
    cat drom_full_scraper_progress.json | python3 -m json.tool
else
    echo "Файл прогресса не найден"
fi

echo ""
echo "================================================================================"
echo "ПОСЛЕДНИЕ 30 СТРОК ЛОГА"
echo "================================================================================"
echo ""

tail -30 parser_output.log

echo ""
echo "================================================================================"
echo "РАЗМЕР ФАЙЛОВ"
echo "================================================================================"
echo ""

ls -lh drom_full_scraper_*.xlsx 2>/dev/null | grep -v backup | grep -v copy

echo ""
echo "================================================================================"
echo "Для просмотра полного лога: cat parser_output.log"
echo "Для просмотра лога в реальном времени: tail -f parser_output.log"
echo "Для остановки парсера: kill \$(ps aux | grep 'full_parser.py' | grep -v grep | awk '{print \$2}')"
echo "================================================================================"
